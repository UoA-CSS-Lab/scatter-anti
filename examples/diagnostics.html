<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebGPU Diagnostics</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Courier New', monospace;
      background: #1a1a1a;
      color: #00ff00;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #000;
      padding: 20px;
      border: 2px solid #00ff00;
      border-radius: 8px;
    }

    h1 {
      color: #00ff00;
      text-align: center;
      margin-bottom: 30px;
    }

    .section {
      margin: 20px 0;
      padding: 15px;
      background: #0a0a0a;
      border: 1px solid #00aa00;
      border-radius: 4px;
    }

    .section h2 {
      color: #00ff00;
      margin-top: 0;
      font-size: 18px;
    }

    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      font-weight: bold;
    }

    .status.success {
      background: #003300;
      color: #00ff00;
      border: 1px solid #00ff00;
    }

    .status.error {
      background: #330000;
      color: #ff0000;
      border: 1px solid #ff0000;
    }

    .status.warning {
      background: #332200;
      color: #ffaa00;
      border: 1px solid #ffaa00;
    }

    pre {
      background: #000;
      padding: 10px;
      border-left: 3px solid #00aa00;
      overflow-x: auto;
      white-space: pre-wrap;
    }

    code {
      color: #00ffff;
    }

    .help {
      margin-top: 20px;
      padding: 15px;
      background: #001a1a;
      border: 1px solid #00aaaa;
      border-radius: 4px;
    }

    .help h3 {
      color: #00ffff;
      margin-top: 0;
    }

    .help ul {
      color: #00ffff;
    }

    a {
      color: #00aaff;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>WebGPU Diagnostics Tool</h1>

    <div class="section">
      <h2>Browser Information</h2>
      <div id="browser-info">Detecting...</div>
    </div>

    <div class="section">
      <h2>WebGPU API Status</h2>
      <div id="api-status">Checking...</div>
    </div>

    <div class="section">
      <h2>GPU Adapter Status</h2>
      <div id="adapter-status">Checking...</div>
    </div>

    <div class="section">
      <h2>Adapter Features</h2>
      <div id="adapter-features">N/A</div>
    </div>

    <div class="section">
      <h2>Adapter Limits</h2>
      <div id="adapter-limits">N/A</div>
    </div>

    <div class="help">
      <h3>Troubleshooting Guide</h3>
      <ul>
        <li><strong>Chrome/Edge:</strong> Visit <code>chrome://gpu</code> to check WebGPU status</li>
        <li><strong>Chrome/Edge:</strong> Ensure you're using version 113 or higher</li>
        <li><strong>Safari:</strong> Requires macOS Sonoma 14.4+ and Safari 18+</li>
        <li><strong>Firefox:</strong> WebGPU is behind a flag - visit <code>about:config</code> and enable <code>dom.webgpu.enabled</code></li>
        <li><strong>GPU Drivers:</strong> Update to the latest GPU drivers from your manufacturer</li>
        <li><strong>Virtual Machines:</strong> WebGPU may not work in VMs without GPU passthrough</li>
        <li><strong>Linux:</strong> Some configurations may require additional setup</li>
      </ul>
      <p>
        For more information, visit:
        <a href="https://developer.chrome.com/blog/webgpu-release/" target="_blank">WebGPU Chrome Blog</a> |
        <a href="https://caniuse.com/webgpu" target="_blank">Can I Use WebGPU?</a>
      </p>
    </div>
  </div>

  <script type="module">
    import { diagnoseWebGPU } from '../dist/index.js';

    async function runDiagnostics() {
      // Browser info
      const browserInfo = document.getElementById('browser-info');
      const ua = navigator.userAgent;
      browserInfo.innerHTML = `<pre>${ua}</pre>`;

      // Run diagnostics
      const diagnostics = await diagnoseWebGPU();

      // API Status
      const apiStatus = document.getElementById('api-status');
      if (diagnostics.supported) {
        apiStatus.innerHTML = `
          <div class="status success">✓ WebGPU API is available in navigator</div>
          <p>Browser: <strong>${diagnostics.browser}</strong></p>
        `;
      } else {
        apiStatus.innerHTML = `
          <div class="status error">✗ WebGPU API is NOT available</div>
          <p>Browser: <strong>${diagnostics.browser}</strong></p>
          <p>Your browser does not support WebGPU. Please upgrade or switch browsers.</p>
        `;
      }

      // Adapter Status
      const adapterStatus = document.getElementById('adapter-status');
      if (diagnostics.adapter.available) {
        adapterStatus.innerHTML = `
          <div class="status success">✓ GPU Adapter successfully obtained</div>
          <p>WebGPU is fully functional on your system!</p>
        `;
      } else if (diagnostics.supported) {
        adapterStatus.innerHTML = `
          <div class="status error">✗ Failed to obtain GPU Adapter</div>
          <p><strong>Error:</strong> ${diagnostics.error || 'Unknown error'}</p>
          <p>Possible causes:</p>
          <ul>
            <li>GPU is blocklisted or unsupported</li>
            <li>WebGPU is disabled in browser flags</li>
            <li>GPU drivers are outdated</li>
            <li>Running in a virtual machine</li>
          </ul>
        `;
      } else {
        adapterStatus.innerHTML = `<div class="status warning">N/A - WebGPU API not available</div>`;
      }

      // Features
      const featuresDiv = document.getElementById('adapter-features');
      if (diagnostics.adapter.features && diagnostics.adapter.features.length > 0) {
        featuresDiv.innerHTML = `
          <pre>${diagnostics.adapter.features.join('\n')}</pre>
          <p><small>Total: ${diagnostics.adapter.features.length} feature(s)</small></p>
        `;
      } else {
        featuresDiv.innerHTML = '<p>No features available or adapter not obtained</p>';
      }

      // Limits
      const limitsDiv = document.getElementById('adapter-limits');
      if (diagnostics.adapter.limits) {
        const limitsStr = JSON.stringify(diagnostics.adapter.limits, null, 2);
        limitsDiv.innerHTML = `<pre>${limitsStr}</pre>`;
      } else {
        limitsDiv.innerHTML = '<p>No limits available or adapter not obtained</p>';
      }

      // Also log to console
      console.log('=== WebGPU Diagnostics ===');
      console.log(diagnostics);
    }

    runDiagnostics().catch(error => {
      console.error('Diagnostics failed:', error);
      document.body.innerHTML += `
        <div style="background: #330000; color: #ff0000; padding: 20px; margin: 20px; border: 2px solid #ff0000;">
          <h2>Fatal Error</h2>
          <pre>${error.message}</pre>
        </div>
      `;
    });
  </script>
</body>
</html>
